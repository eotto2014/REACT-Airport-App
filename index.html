<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airport Task Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            @page { 
                size: letter;
                margin: 0.5in;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script type="module">
        import React, { useState, useEffect } from 'https://cdn.skypack.dev/react@18.2.0';
        import ReactDOM from 'https://cdn.skypack.dev/react-dom@18.2.0';
        import * as LucideIcons from 'https://cdn.skypack.dev/lucide-react@0.263.1';

        const { Plus, Edit2, Trash2, MessageSquare, X, Check, Calendar, AlertCircle, Repeat, Settings, ChevronDown, ChevronRight, FolderOpen } = LucideIcons;

        const AirportTaskTracker = () => {
            const [tasks, setTasks] = useState([]);
            const [activeTab, setActiveTab] = useState('active');
            const [showTaskModal, setShowTaskModal] = useState(false);
            const [showRemarksModal, setShowRemarksModal] = useState(false);
            const [showSettingsModal, setShowSettingsModal] = useState(false);
            const [showSubtaskModal, setShowSubtaskModal] = useState(false);
            const [editingTask, setEditingTask] = useState(null);
            const [currentTaskForRemarks, setCurrentTaskForRemarks] = useState(null);
            const [currentProjectForSubtask, setCurrentProjectForSubtask] = useState(null);
            const [editingSubtask, setEditingSubtask] = useState(null);
            const [newRemark, setNewRemark] = useState('');
            const [newTeamMember, setNewTeamMember] = useState('');
            const [newEquipment, setNewEquipment] = useState('');
            const [expandedProjects, setExpandedProjects] = useState({});
            
            const [filters, setFilters] = useState({
                category: 'all',
                priority: 'all',
                assignee: 'all',
                status: 'all',
                equipment: 'all',
                dueDate: 'all'
            });

            const [taskForm, setTaskForm] = useState({
                title: '',
                category: 'fuel-qc',
                priority: 'none',
                assignee: '',
                status: 'not-started',
                equipment: '',
                dueDate: '',
                notes: '',
                isRecurring: false,
                recurringInterval: 'weekly',
                isMajorProject: false,
                subtasks: [],
                remarks: []
            });

            const [subtaskForm, setSubtaskForm] = useState({
                title: '',
                assignee: '',
                priority: 'none',
                dueDate: '',
                status: 'not-started',
                notes: ''
            });

            const categories = [
                { id: 'fuel-qc', label: 'Fuel Quality Control', color: 'bg-violet-500' },
                { id: 'services', label: 'Scheduled Services', color: 'bg-blue-500' },
                { id: 'faults', label: 'Faults and Repairs', color: 'bg-red-500' },
                { id: 'capital', label: 'Capital Improvement Projects', color: 'bg-amber-500' },
                { id: 'administrative', label: 'Administrative Tasks', color: 'bg-cyan-500' }
            ];

            const priorities = [
                { id: 'none', label: 'None', color: 'bg-slate-500' },
                { id: 'low', label: 'Low', color: 'bg-green-500' },
                { id: 'medium', label: 'Medium', color: 'bg-yellow-500' },
                { id: 'high', label: 'High', color: 'bg-orange-500' },
                { id: 'mission-critical', label: 'Mission Critical', color: 'bg-red-600' }
            ];

            const statuses = [
                { id: 'not-started', label: 'Not Started' },
                { id: 'in-progress', label: 'In Progress' },
                { id: 'on-hold', label: 'On Hold' },
                { id: 'completed', label: 'Completed' }
            ];

            const [teamMembers, setTeamMembers] = useState(['Pat', 'Evan', 'Cody', 'Wyatt', 'Carlos']);
            const [equipment, setEquipment] = useState([
                'Jet Fuel Truck 1', 'Jet Fuel Truck 2', 'Avgas Truck 1', 'Fire Truck',
                'Hangar 1', 'Hangar 2', 'Hangar 3', 'Hangar 4', 'Terminal Building',
                'Fuel Storage Tank 1', 'Fuel Storage Tank 2', 'Fuel Storage Tank 3',
                'Runway Lighting System', 'AWOS Station'
            ]);

            useEffect(() => {
                const saved = localStorage.getItem('airportTasksV2');
                if (saved) {
                    setTasks(JSON.parse(saved));
                }
                const savedTeam = localStorage.getItem('airportTeamMembers');
                if (savedTeam) {
                    setTeamMembers(JSON.parse(savedTeam));
                }
                const savedEquipment = localStorage.getItem('airportEquipment');
                if (savedEquipment) {
                    setEquipment(JSON.parse(savedEquipment));
                }
            }, []);

            useEffect(() => {
                if (tasks.length > 0) {
                    localStorage.setItem('airportTasksV2', JSON.stringify(tasks));
                }
            }, [tasks]);

            useEffect(() => {
                localStorage.setItem('airportTeamMembers', JSON.stringify(teamMembers));
            }, [teamMembers]);

            useEffect(() => {
                localStorage.setItem('airportEquipment', JSON.stringify(equipment));
            }, [equipment]);

            const resetTaskForm = () => {
                setTaskForm({
                    title: '',
                    category: 'fuel-qc',
                    priority: 'none',
                    assignee: '',
                    status: 'not-started',
                    equipment: '',
                    dueDate: '',
                    notes: '',
                    isRecurring: false,
                    recurringInterval: 'weekly',
                    isMajorProject: false,
                    subtasks: [],
                    remarks: []
                });
            };

            const resetSubtaskForm = () => {
                setSubtaskForm({
                    title: '',
                    assignee: '',
                    priority: 'none',
                    dueDate: '',
                    status: 'not-started',
                    notes: ''
                });
            };

            const openAddTask = () => {
                resetTaskForm();
                setEditingTask(null);
                setShowTaskModal(true);
            };

            const openEditTask = (task) => {
                setTaskForm(task);
                setEditingTask(task);
                setShowTaskModal(true);
            };

            const saveTask = () => {
                if (!taskForm.title.trim()) return;

                if (editingTask) {
                    setTasks(tasks.map(t => t.id === editingTask.id ? { ...taskForm, id: editingTask.id } : t));
                } else {
                    const newTask = {
                        ...taskForm,
                        id: Date.now(),
                        createdAt: new Date().toISOString(),
                        subtasks: taskForm.isMajorProject ? [] : undefined
                    };
                    setTasks([...tasks, newTask]);
                }
                
                setShowTaskModal(false);
                resetTaskForm();
            };

            const deleteTask = (id) => {
                setTasks(tasks.filter(t => t.id !== id));
            };

            const updateTaskStatus = (id, newStatus) => {
                setTasks(tasks.map(t => {
                    if (t.id === id) {
                        if (t.isMajorProject) {
                            return t;
                        }
                        return { ...t, status: newStatus };
                    }
                    return t;
                }));
            };

            const openRemarksModal = (task) => {
                setCurrentTaskForRemarks(task);
                setNewRemark('');
                setShowRemarksModal(true);
            };

            const addRemark = () => {
                if (!newRemark.trim()) return;
                
                const remark = {
                    id: Date.now(),
                    text: newRemark,
                    timestamp: new Date().toISOString()
                };
                
                setTasks(tasks.map(t => 
                    t.id === currentTaskForRemarks.id 
                        ? { ...t, remarks: [...(t.remarks || []), remark] }
                        : t
                ));
                
                setNewRemark('');
            };

            const openAddSubtask = (project) => {
                setCurrentProjectForSubtask(project);
                setEditingSubtask(null);
                resetSubtaskForm();
                setShowSubtaskModal(true);
            };

            const openEditSubtask = (project, subtask) => {
                setCurrentProjectForSubtask(project);
                setEditingSubtask(subtask);
                setSubtaskForm(subtask);
                setShowSubtaskModal(true);
            };

            const saveSubtask = () => {
                if (!subtaskForm.title.trim()) return;

                setTasks(tasks.map(t => {
                    if (t.id === currentProjectForSubtask.id) {
                        let updatedSubtasks;
                        if (editingSubtask) {
                            updatedSubtasks = t.subtasks.map(st => 
                                st.id === editingSubtask.id ? { ...subtaskForm, id: editingSubtask.id } : st
                            );
                        } else {
                            const newSubtask = {
                                ...subtaskForm,
                                id: Date.now(),
                                createdAt: new Date().toISOString()
                            };
                            updatedSubtasks = [...t.subtasks, newSubtask];
                        }
                        
                        const allCompleted = updatedSubtasks.every(st => st.status === 'completed');
                        
                        return {
                            ...t,
                            subtasks: updatedSubtasks,
                            status: allCompleted && updatedSubtasks.length > 0 ? 'completed' : t.status
                        };
                    }
                    return t;
                }));

                setShowSubtaskModal(false);
                resetSubtaskForm();
            };

            const deleteSubtask = (projectId, subtaskId) => {
                setTasks(tasks.map(t => {
                    if (t.id === projectId) {
                        const updatedSubtasks = t.subtasks.filter(st => st.id !== subtaskId);
                        const allCompleted = updatedSubtasks.every(st => st.status === 'completed');
                        
                        return {
                            ...t,
                            subtasks: updatedSubtasks,
                            status: allCompleted && updatedSubtasks.length > 0 ? 'completed' : 'in-progress'
                        };
                    }
                    return t;
                }));
            };

            const updateSubtaskStatus = (projectId, subtaskId, newStatus) => {
                setTasks(tasks.map(t => {
                    if (t.id === projectId) {
                        const updatedSubtasks = t.subtasks.map(st => 
                            st.id === subtaskId ? { ...st, status: newStatus } : st
                        );
                        
                        const allCompleted = updatedSubtasks.every(st => st.status === 'completed');
                        
                        return {
                            ...t,
                            subtasks: updatedSubtasks,
                            status: allCompleted && updatedSubtasks.length > 0 ? 'completed' : 'in-progress'
                        };
                    }
                    return t;
                }));
            };

            const toggleProjectExpansion = (projectId) => {
                setExpandedProjects(prev => ({
                    ...prev,
                    [projectId]: !prev[projectId]
                }));
            };

            const getProjectProgress = (task) => {
                if (!task.isMajorProject || !task.subtasks || task.subtasks.length === 0) {
                    return null;
                }
                const completed = task.subtasks.filter(st => st.status === 'completed').length;
                const total = task.subtasks.length;
                return { completed, total, percentage: Math.round((completed / total) * 100) };
            };

            const addTeamMember = () => {
                if (newTeamMember.trim() && !teamMembers.includes(newTeamMember.trim())) {
                    setTeamMembers([...teamMembers, newTeamMember.trim()]);
                    setNewTeamMember('');
                }
            };

            const addEquipment = () => {
                if (newEquipment.trim() && !equipment.includes(newEquipment.trim())) {
                    setEquipment([...equipment, newEquipment.trim()]);
                    setNewEquipment('');
                }
            };

            const getCategoryInfo = (id) => categories.find(c => c.id === id);
            const getPriorityInfo = (id) => priorities.find(p => p.id === id);
            const getStatusLabel = (id) => statuses.find(s => s.id === id)?.label;

            const getFilteredTasks = () => {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const weekFromNow = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                const twoWeeksFromNow = new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000);
                const monthFromNow = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
                const twoMonthsFromNow = new Date(today.getTime() + 60 * 24 * 60 * 60 * 1000);
                
                const currentQuarter = Math.floor(now.getMonth() / 3);
                const quarterEndMonth = (currentQuarter + 1) * 3 - 1;
                const quarterEnd = new Date(now.getFullYear(), quarterEndMonth + 1, 0);

                return tasks.filter(task => {
                    const tabMatch = activeTab === 'active' ? task.status !== 'completed' : task.status === 'completed';
                    if (!tabMatch) return false;

                    if (filters.category !== 'all' && task.category !== filters.category) return false;
                    if (filters.priority !== 'all' && task.priority !== filters.priority) return false;
                    if (filters.assignee !== 'all' && task.assignee !== filters.assignee) return false;
                    if (filters.status !== 'all' && task.status !== filters.status) return false;
                    if (filters.equipment !== 'all' && task.equipment !== filters.equipment) return false;
                    
                    if (filters.dueDate !== 'all' && task.dueDate) {
                        const dueDate = new Date(task.dueDate);
                        switch (filters.dueDate) {
                            case 'today':
                                if (dueDate.toDateString() !== today.toDateString()) return false;
                                break;
                            case 'week':
                                if (dueDate > weekFromNow || dueDate < today) return false;
                                break;
                            case 'next-week':
                                if (dueDate <= weekFromNow || dueDate > twoWeeksFromNow) return false;
                                break;
                            case 'month':
                                if (dueDate > monthFromNow || dueDate < today) return false;
                                break;
                            case 'next-month':
                                if (dueDate <= monthFromNow || dueDate > twoMonthsFromNow) return false;
                                break;
                            case 'quarter':
                                if (dueDate > quarterEnd || dueDate < today) return false;
                                break;
                        }
                    }
                    
                    return true;
                });
            };

            const filteredTasks = getFilteredTasks();

            return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-4 md:p-8" },
                React.createElement('div', { className: "max-w-7xl mx-auto" },
                    React.createElement('div', { className: "bg-slate-800 rounded-xl shadow-2xl p-6 mb-6 border border-slate-700" },
                        React.createElement('div', { className: "flex justify-between items-center mb-6" },
                            React.createElement('div', null,
                                React.createElement('h1', { className: "text-3xl font-bold text-white" }, 'Airport Task Tracker'),
                                React.createElement('p', { className: "text-slate-500 text-sm mt-1" }, 'Version 1 | October 18th, 2025')
                            ),
                            React.createElement('div', { className: "flex gap-3" },
                                React.createElement('button', {
                                    onClick: () => setShowSettingsModal(true),
                                    className: "flex items-center gap-2 bg-slate-700 text-white px-4 py-2 rounded-lg hover:bg-slate-600 transition-all shadow-lg border border-slate-600"
                                },
                                    React.createElement(Settings, { size: 20 }),
                                    'Settings'
                                ),
                                React.createElement('button', {
                                    onClick: openAddTask,
                                    className: "flex items-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white px-4 py-2 rounded-lg hover:from-green-500 hover:to-emerald-500 transition-all shadow-lg"
                                },
                                    React.createElement(Plus, { size: 20 }),
                                    'Add Task'
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex gap-2 border-b border-slate-700" },
                            React.createElement('button', {
                                onClick: () => setActiveTab('active'),
                                className: `px-4 py-2 font-medium transition-colors ${activeTab === 'active' ? 'text-cyan-400 border-b-2 border-cyan-400' : 'text-slate-400 hover:text-slate-300'}`
                            }, `Active Tasks (${tasks.filter(t => t.status !== 'completed').length})`),
                            React.createElement('button', {
                                onClick: () => setActiveTab('completed'),
                                className: `px-4 py-2 font-medium transition-colors ${activeTab === 'completed' ? 'text-cyan-400 border-b-2 border-cyan-400' : 'text-slate-400 hover:text-slate-300'}`
                            }, `Completed Tasks (${tasks.filter(t => t.status === 'completed').length})`)
                        )
                    ),
                    React.createElement('div', { className: "bg-slate-800 rounded-xl shadow-xl p-4 mb-6 border border-slate-700" },
                        React.createElement('div', { className: "flex flex-wrap gap-2 items-center" },
                            React.createElement('span', { className: "text-slate-400 text-sm font-medium mr-2" }, 'Filters:'),
                            React.createElement('select', {
                                value: filters.category,
                                onChange: (e) => setFilters({...filters, category: e.target.value}),
                                className: "bg-slate-700 border border-slate-600 text-white rounded-lg px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-cyan-500"
                            },
                                React.createElement('option', { value: "all" }, 'All Categories'),
                                categories.map(c => React.createElement('option', { key: c.id, value: c.id }, c.label))
                            ),
                            React.createElement('select', {
                                value: filters.priority,
                                onChange: (e) => setFilters({...filters, priority: e.target.value}),
                                className: "bg-slate-700 border border-slate-600 text-white rounded-lg px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-cyan-500"
                            },
                                React.createElement('option', { value: "all" }, 'All Priorities'),
                                priorities.map(p => React.createElement('option', { key: p.id, value: p.id }, p.label))
                            ),
                            React.createElement('select', {
                                value: filters.assignee,
                                onChange: (e) => setFilters({...filters, assignee: e.target.value}),
                                className: "bg-slate-700 border border-slate-600 text-white rounded-lg px-2 py-1 text-xs focus:outline-none focus:ring-2 focus:ring-cyan-500"
                            },
                                React.createElement('option', { value: "all" }, 'All Team Members'),
                                teamMembers.map(m => React.createElement('option', { key: m, value: m }, m))
                            )
                        )
                    ),
                    React.createElement('div', { className: "text-center text-slate-400 py-8" },
                        'Task display functionality would appear here'
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(AirportTaskTracker), document.getElementById('app'));
    </script>
</body>
</html>
